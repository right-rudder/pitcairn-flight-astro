---
import BaseLayout from "../layouts/BaseLayout.astro";
import ImageComp from "../components/ImageComp.astro";
import { EMAIL_ADDRESS, PHONE_NUMBER } from "../data/consts";
import Hero75 from "../components/Hero75.astro";
import CTASectionWithGradientCover from "../components/CTASectionWithGradientCover.astro";
import FAQSidebarEnroll from "../components/FAQSidebarEnroll.astro";

// Import environment variables
const ENROLLMENT_FORM_WEBHOOK_URL = import.meta.env.ENROLLMENT_FORM_WEBHOOK_URL;
const PORTAL_API_KEY = import.meta.env.PORTAL_API_KEY;
const CP_ACCOUNT_RANDOM_ID = import.meta.env.CP_ACCOUNT_RANDOM_ID;

const heroData = {
  image: {
    src: "/src/assets/-MultiEngine-Flying.jpg",
    alt: "Enroll at {COMPANY_NAME}",
  },
  title: "Start Your Aviation Journey",
  subTitle:
    "Take the first step towards your pilot career. Complete the enrollment form below and our admissions team will contact you within 24 hours.",
};

const ctaData = {
  title: "Define Your Mission. Let’s Reach the Majors Together.",
  description:
    "Your first step at  is defining that goal, as it will shape your standards, timeline, and path to the cockpit. Whether you are aiming for the airlines or mastering a new rating, we are here to provide the roadmap and the mentorship to get you there. Define your mission today, and let’s start your training plan.",
  image: {
    src: "/src/assets/sebastian-zzWYD-tc_jI-unsplash.jpg",
    alt: "Training aircraft in flight",
  },
  primaryCTA: {
    text: "Schedule a Tour",
    href: "/contact",
  },
  secondaryCTA: {
    text: "Enroll Now",
    href: "/enroll",
  },
};

const faqData = {
  upperheader: "Ready to Launch",
  title: "Enrollment & Training FAQs",
  qnas: [
    {
      question: "What happens if I don't have my financing secured yet?",
      answer:
        "That is perfectly fine for the initial application. You can apply today to start the interview process. Once you are accepted, we will help guide you toward our financing partners, like Stratus, to secure your loan and finalize your start date.",
    },
    {
      question: "Is the housing included really located near the academy?",
      answer:
        "Yes. For our Professional Pilot Track students, we provide housing for up to 8 months. This eliminates the stress of searching for a short-term lease and ensures you are surrounded by a community of fellow students who are just as focused on the mission as you are.",
    },
    {
      question:
        "The schedule seems intense. Can I work a part-time job while enrolled?",
      answer:
        "We treat our Professional Pilot Track like a full-time career from day one. Expect to be at the flight school 8 hours a day, Monday through Friday. To ensure you succeed and meet the 8-10 month timeline, we strongly recommend students dedicate themselves fully to the program without the distraction of outside employment.",
    },
    {
      question: "How do the 'incentive-based' jobs work?",
      answer:
        "We are looking for our future colleagues. If you excel in the course and demonstrate the character of a professional pilot, we don't just graduate you—we want to hire you. This includes potential paths to CFI, MEI, and even Part 135 positions within our network, with  covering costs for advanced ratings for top-tier performers.",
    },
    {
      question: "I’m not a military pilot; is this program still right for me?",
      answer:
        "Absolutely. While our roots are in the USAF and we specialize in transitioning military aviators, the Academy was built to bring that same high-level discipline and 'wingman' culture to civilian students. You’ll be training alongside and learning from instructors who have flown at the highest levels of combat and commercial aviation.",
    },
  ],
};

const metaProps = {
  siteTitle: "Enrollment | {COMPANY_NAME}",
  siteDescription:
    "Take the first step toward your professional pilot career. Complete the  Aviation enrollment form to begin your interview process and secure your start date.",
  siteKeywords:
    "flight school enrollment, pilot training application, apply for flight school,  admission, start pilot training, flight training application NC",
};
---

<BaseLayout {...metaProps}>
  <Hero75 data={heroData} />

  <section class="py-16 md:py-24 bg-white">
    <div class="max-w-7xl mx-auto px-5 md:px-8 lg:px-12">
      <div class="grid lg:grid-cols-2 gap-12">
        <div>
          <h2 class="text-3xl font-bold text-gray-900 mb-6">
            Enrollment Application
          </h2>
          <p class="text-lg text-gray-600 mb-8">
            Complete the form below to begin your enrollment process. Our
            admissions team will review your application and contact you within
            24 hours to schedule your consultation.
          </p>

          <form id="enrollForm" class="space-y-6">
            <div class="hidden" aria-hidden="true">
              <label for="website">Website</label>
              <input
                type="text"
                id="website"
                name="website"
                tabindex="-1"
                autocomplete="off"
              />
            </div>

            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
              <h3 class="font-bold text-gray-900 mb-4">Personal Information</h3>

              <div class="space-y-4">
                <div>
                  <label
                    for="name"
                    class="block text-sm font-semibold text-gray-700 mb-2"
                  >
                    Full Name <span class="text-monza-600">*</span>
                  </label>
                  <input
                    type="text"
                    id="name"
                    name="name"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-monza-500 focus:border-monza-500 transition-colors"
                    placeholder="John Doe"
                  />
                </div>

                <div>
                  <label
                    for="email"
                    class="block text-sm font-semibold text-gray-700 mb-2"
                  >
                    Email Address <span class="text-monza-600">*</span>
                  </label>
                  <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-monza-500 focus:border-monza-500 transition-colors"
                    placeholder="john@example.com"
                  />
                </div>

                <div>
                  <label
                    for="phone"
                    class="block text-sm font-semibold text-gray-700 mb-2"
                  >
                    Phone Number <span class="text-monza-600">*</span>
                  </label>
                  <input
                    type="tel"
                    id="phone"
                    name="phone"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-monza-500 focus:border-monza-500 transition-colors"
                    placeholder="(555) 123-4567"
                  />
                </div>

                <div>
                  <label
                    for="dob"
                    class="block text-sm font-semibold text-gray-700 mb-2"
                  >
                    Date of Birth <span class="text-monza-600">*</span>
                  </label>
                  <input
                    type="date"
                    id="dob"
                    name="dob"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-monza-500 focus:border-monza-500 transition-colors"
                  />
                </div>
              </div>
            </div>

            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
              <h3 class="font-bold text-gray-900 mb-4">Program Selection</h3>

              <div class="space-y-4">
                <div>
                  <label
                    for="program"
                    class="block text-sm font-semibold text-gray-700 mb-2"
                  >
                    Which program are you interested in? <span
                      class="text-monza-600">*</span
                    >
                  </label>
                  <select
                    id="program"
                    name="program"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-monza-500 focus:border-monza-500 transition-colors"
                  >
                    <option value="">Select a program...</option>
                    <option value="Zero to Airlines">
                      Zero to Airlines (Complete Career Track)
                    </option>
                    <option value="Multi-Engine Rating"
                      >Multi-Engine Rating</option
                    >
                    <option value="Private Pilot">Private Pilot License</option>
                    <option value="Instrument Rating">Instrument Rating</option>
                    <option value="Commercial Pilot"
                      >Commercial Pilot License</option
                    >
                    <option value="CFI/CFII"
                      >Flight Instructor (CFI/CFII)</option
                    >
                    <option value="Military Transition"
                      >Military Transition Program</option
                    >
                    <option value="Not Sure">Not Sure Yet</option>
                  </select>
                </div>

                <div>
                  <label
                    for="startDate"
                    class="block text-sm font-semibold text-gray-700 mb-2"
                  >
                    When would you like to start? <span class="text-monza-600"
                      >*</span
                    >
                  </label>
                  <select
                    id="startDate"
                    name="startDate"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-monza-500 focus:border-monza-500 transition-colors"
                  >
                    <option value="">Select timeframe...</option>
                    <option value="Immediately">Immediately</option>
                    <option value="Within 1 Month">Within 1 Month</option>
                    <option value="1-3 Months">1-3 Months</option>
                    <option value="3-6 Months">3-6 Months</option>
                    <option value="6+ Months">6+ Months</option>
                    <option value="Just Exploring"
                      >Just Exploring Options</option
                    >
                  </select>
                </div>
              </div>
            </div>

            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
              <h3 class="font-bold text-gray-900 mb-4">Aviation Background</h3>

              <div class="space-y-4">
                <div>
                  <label
                    for="militaryExperience"
                    class="block text-sm font-semibold text-gray-700 mb-2"
                  >
                    Military Aviation Experience
                  </label>
                  <select
                    id="militaryExperience"
                    name="militaryExperience"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-monza-500 focus:border-monza-500 transition-colors"
                  >
                    <option value="">Select...</option>
                    <option value="None">No Military Experience</option>
                    <option value="Active Duty Pilot">Active Duty Pilot</option>
                    <option value="Veteran Pilot">Veteran Pilot</option>
                    <option value="Military Non-Pilot"
                      >Military (Non-Pilot)</option
                    >
                  </select>
                </div>
              </div>
            </div>

            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
              <h3 class="font-bold text-gray-900 mb-4">Financing</h3>

              <div class="space-y-4">
                <div>
                  <label
                    for="financing"
                    class="block text-sm font-semibold text-gray-700 mb-2"
                  >
                    Are you interested in financing options?
                  </label>
                  <select
                    id="financing"
                    name="financing"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-monza-500 focus:border-monza-500 transition-colors"
                  >
                    <option value="">Select...</option>
                    <option value="Yes">Yes, I need financing</option>
                    <option value="Maybe">Maybe, want to learn more</option>
                    <option value="No">No, I'll pay out of pocket</option>
                    <option value="GI Bill">Using GI Bill / VA Benefits</option>
                  </select>
                </div>
              </div>
            </div>

            <div>
              <label
                for="message"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Additional Information or Questions
              </label>
              <textarea
                id="message"
                name="message"
                rows="4"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-monza-500 focus:border-monza-500 transition-colors resize-none"
                placeholder="Tell us anything else we should know about your goals, schedule, or questions you have..."
              ></textarea>
            </div>

            <div class="flex gap-x-4">
              <div class="flex h-6 items-center">
                <button
                  type="button"
                  id="terms-toggle"
                  class="bg-gray-200 flex w-8 flex-none cursor-pointer rounded-full p-px ring-1 ring-inset ring-gray-900/5 transition-colors duration-200 ease-in-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-monza-600"
                  role="switch"
                  aria-checked="false"
                  aria-labelledby="switch-1-label"
                >
                  <span class="sr-only">Agree to terms</span>
                  <span
                    id="terms-thumb"
                    class="translate-x-0 h-4 w-4 transform rounded-full bg-white shadow-sm ring-1 ring-gray-900/5 transition duration-200 ease-in-out"
                    aria-hidden="true"></span>
                </button>
                <input
                  type="hidden"
                  id="agree-terms"
                  name="agree-terms"
                  value="no"
                />
              </div>
              <label
                class="text-sm leading-6 text-gray-600"
                id="switch-1-label"
              >
                I agree to the <a
                  href="/privacy-policy"
                  class="font-semibold text-monza-600 hover:text-monza-500"
                  >Privacy Policy</a
                > and <a
                  href="/terms-of-service"
                  class="font-semibold text-monza-600 hover:text-monza-500"
                  >Terms of Service</a
                > provided by the company. By providing my phone number, I agree to
                receive text notes from the business.
              </label>
            </div>

            <div>
              <button
                type="submit"
                id="submit-btn"
                disabled
                class="w-full bg-gray-400 cursor-not-allowed text-white px-8 py-4 rounded-lg font-bold text-lg transition-colors shadow-lg flex items-center justify-center"
              >
                <span id="buttonText">Submit Enrollment Application</span>
                <svg
                  id="buttonSpinner"
                  class="hidden animate-spin ml-3 h-5 w-5 text-white"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <circle
                    class="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    stroke-width="4"></circle>
                  <path
                    class="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                  ></path>
                </svg>
              </button>
            </div>

            <div
              id="successMessage"
              class="hidden bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg"
            >
              <div class="flex items-start">
                <svg
                  class="w-6 h-6 text-green-500 mr-3 shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                  <h3 class="text-green-800 font-semibold">
                    Application Submitted!
                  </h3>
                  <p class="text-green-700 text-sm mt-1">
                    Redirecting to confirmation page...
                  </p>
                </div>
              </div>
            </div>

            <div
              id="errorMessage"
              class="hidden bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg"
            >
              <div class="flex items-start">
                <svg
                  class="w-6 h-6 text-red-500 mr-3 shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                  ></path>
                </svg>
                <div>
                  <h3 class="text-red-800 font-semibold">Error</h3>
                  <p class="text-red-700 text-sm mt-1" id="errorText">
                    Something went wrong. Please try again or call us directly.
                  </p>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div>
          <h2 class="text-3xl font-bold text-gray-900 mb-6">What's Next?</h2>
          <div class="flex items-start">
            <div
              class="w-12 h-12 bg-monza-600 text-white rounded-full flex items-center justify-center shrink-0 mr-4 font-bold text-lg"
            >
              1
            </div>
            <div>
              <h3 class="!font-sans !not-italic !text-xl text-gray-900 mb-1">
                Application Review
              </h3>
              <p class="text-gray-700">
                Our admissions team reviews your application and prepares a
                personalized training plan based on your background and goals.
                We analyze your long-term objectives to ensure you are placed in
                the track that maximizes your career potential.
              </p>
            </div>
          </div>
          <br />
          <div class="flex items-start">
            <div
              class="w-12 h-12 bg-monza-600 text-white rounded-full flex items-center justify-center shrink-0 mr-4 font-bold text-lg"
            >
              2
            </div>
            <div>
              <h3 class="!font-sans !not-italic !text-xl text-gray-900 mb-1">
                Consultation Call
              </h3>
              <p class="text-gray-700">
                We'll contact you within 24 hours to schedule a consultation
                where we'll discuss your training options, timeline, and
                financing. This is where we define your specific milestones and
                answer any questions about our 8-10 month professional
                curriculum.
              </p>
            </div>
          </div>
          <br />
          <div class="flex items-start">
            <div
              class="w-12 h-12 bg-monza-600 text-white rounded-full flex items-center justify-center shrink-0 mr-4 font-bold text-lg"
            >
              3
            </div>
            <div>
              <h3 class="!font-sans !not-italic !text-xl text-gray-900 mb-1">
                Facility Tour & Medical
              </h3>
              <p class="text-gray-700">
                Visit our training facility, meet our instructors, and get
                guidance on obtaining your medical certificate. You'll see our
                fleet firsthand and meet the senior CFI cadre who will be
                mentoring you throughout your journey.
              </p>
            </div>
          </div>
          <br />
          <div class="flex items-start">
            <div
              class="w-12 h-12 bg-monza-600 text-white rounded-full flex items-center justify-center shrink-0 mr-4 font-bold text-lg"
            >
              4
            </div>
            <div>
              <h3 class="!font-sans !not-italic !text-xl text-gray-900 mb-1">
                Start Training
              </h3>
              <p class="text-gray-700">
                Complete enrollment paperwork, arrange financing through
                partners like Stratus if needed, and begin your flight training
                journey. Once your financing and medical are cleared, we’ll
                assign your primary instructor and set your first day on the
                flight line.
              </p>
            </div>
          </div>
          <br />
          <div
            class="bg-linear-to-br from-gray-800 via-gray-700 to-gray-900 border-2 border-gray-300 text-white rounded-xl p-6 mb-6"
          >
            <h3 class="font-bold text-xl mb-4">Questions?</h3>
            <p class="text-muted-50 mb-4">
              Our admissions team is here to help answer any questions about the
              enrollment process.
            </p>
            <div class="space-y-3">
              <a
                href={`tel:${PHONE_NUMBER}`}
                class="flex items-center text-white hover:text-monza-100"
              >
                <span
                  class="bg-monza-600 text-white rounded-full flex justify-center items-center p-1 mr-2"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                    ></path>
                  </svg>
                </span>
                <span class="">{PHONE_NUMBER}</span>
              </a>
              <a
                href={`mailto:${EMAIL_ADDRESS}`}
                class="flex items-center text-white hover:text-monza-100"
              >
                <span
                  class="bg-monza-600 text-white rounded-full flex justify-center items-center p-1 mr-2"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                    ></path>
                  </svg>
                </span>
                <span class="">{EMAIL_ADDRESS}</span>
              </a>
            </div>
          </div>

          <div class="bg-gray-50 rounded-xl p-6 border border-gray-200">
            <h3 class="font-bold text-xl mb-4">Helpful Resources</h3>
            <ul class="space-y-3 font-semibold text-lucky-500 underline">
              <li>
                <a
                  href="/programs/zero-to-airlines"
                  class="flex items-center hover:text-lucky-800"
                >
                  <svg
                    class="w-4 h-4 mr-2 text-black font-black"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5l7 7-7 7"></path>
                  </svg>
                  View Training Programs
                </a>
              </li>
              <li>
                <a
                  href="/financing"
                  class="flex items-center hover:text-lucky-800"
                >
                  <svg
                    class="w-4 h-4 mr-2 text-black font-black"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5l7 7-7 7"></path>
                  </svg>
                  Financing Options
                </a>
              </li>
              <li>
                <a href="/faqs" class="flex items-center hover:text-lucky-800">
                  <svg
                    class="w-4 h-4 mr-2 text-black font-black"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5l7 7-7 7"></path>
                  </svg>
                  Frequently Asked Questions
                </a>
              </li>
              <li>
                <a
                  href="/new-to-flying"
                  class="flex items-center hover:text-lucky-800"
                >
                  <svg
                    class="w-4 h-4 mr-2 text-black font-black"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5l7 7-7 7"></path>
                  </svg>
                  New to Flying?
                </a>
              </li>
            </ul>
          </div>
          <FAQSidebarEnroll data={faqData} />
        </div>
      </div>
    </div>
  </section>

  <section class="py-16 md:py-24 bg-gray-900">
    <div class="max-w-7xl mx-auto px-5 md:px-8 lg:px-12">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-muted-50 mb-4">
          Join {COMPANY_NAME}
        </h2>
        <p class="text-xl text-muted-50 max-w-3xl mx-auto">
          Your enrollment application is the first step toward a rewarding
          aviation career. We're excited to help you achieve your goals.
        </p>
      </div>

      <div class="grid md:grid-cols-3 gap-8">
        <div class="text-center">
          <div
            class="w-16 h-16 bg-monza-100 rounded-full flex items-center justify-center mx-auto mb-4"
          >
            <svg
              class="w-8 h-8 text-monza-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
              ></path>
            </svg>
          </div>
          <h3 class="font-bold text-muted-50 mb-2">FAA Certified</h3>
          <p class="text-muted-50">
            Part 141 & 61 approved training facility with proven programs
          </p>
        </div>

        <div class="text-center">
          <div
            class="w-16 h-16 bg-monza-100 rounded-full flex items-center justify-center mx-auto mb-4"
          >
            <svg
              class="w-8 h-8 text-monza-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
              ></path>
            </svg>
          </div>
          <h3 class="font-bold text-muted-50 mb-2">Expert Instructors</h3>
          <p class="text-muted-50">
            Learn from experienced CFIs with airline and military backgrounds
          </p>
        </div>

        <div class="text-center">
          <div
            class="w-16 h-16 bg-monza-100 rounded-full flex items-center justify-center mx-auto mb-4"
          >
            <svg
              class="w-8 h-8 text-monza-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
          </div>
          <h3 class="font-bold text-muted-50 mb-2">Modern Fleet</h3>
          <p class="text-muted-50">
            Train in well-maintained, modern aircraft with advanced avionics
          </p>
        </div>
      </div>
    </div>
  </section>
  <CTASectionWithGradientCover {...ctaData} />
</BaseLayout>

<script
  define:vars={{
    ENROLLMENT_FORM_WEBHOOK_URL,
    PORTAL_API_KEY,
    CP_ACCOUNT_RANDOM_ID,
  }}
>
  // Elements
  const form = document.getElementById("enrollForm");
  const successMessage = document.getElementById("successMessage");
  const errorMessage = document.getElementById("errorMessage");
  const errorText = document.getElementById("errorText");
  const buttonText = document.getElementById("buttonText");
  const buttonSpinner = document.getElementById("buttonSpinner");
  const submitButton = form.querySelector('button[type="submit"]');

  // Terms Toggle Elements
  const toggle = document.getElementById("terms-toggle");
  const thumb = document.getElementById("terms-thumb");
  const hiddenInput = document.getElementById("agree-terms");
  let isChecked = false;

  const SUBMIT_COOLDOWN = 30 * 1000; // 30 seconds

  // Handle Terms Toggle
  if (toggle && thumb && hiddenInput) {
    toggle.addEventListener("click", () => {
      isChecked = !isChecked;
      hiddenInput.value = isChecked ? "yes" : "no";
      toggle.setAttribute("aria-checked", isChecked.toString());

      // Update styling
      if (isChecked) {
        toggle.classList.remove("bg-gray-200");
        toggle.classList.add("bg-monza-600");
        thumb.classList.remove("translate-x-0");
        thumb.classList.add("translate-x-3.5");

        // Enable Submit Button
        submitButton.disabled = false;
        submitButton.classList.remove(
          "bg-gray-400",
          "cursor-not-allowed",
          "opacity-50"
        );
        submitButton.classList.add(
          "bg-monza-600",
          "hover:bg-monza-700",
          "hover:shadow-xl"
        );
      } else {
        toggle.classList.add("bg-gray-200");
        toggle.classList.remove("bg-monza-600");
        thumb.classList.add("translate-x-0");
        thumb.classList.remove("translate-x-3.5");

        // Disable Submit Button
        submitButton.disabled = true;
        submitButton.classList.add(
          "bg-gray-400",
          "cursor-not-allowed",
          "opacity-50"
        );
        submitButton.classList.remove(
          "bg-monza-600",
          "hover:bg-monza-700",
          "hover:shadow-xl"
        );
      }
    });
  }

  if (!form) {
    console.error("Form element not found.");
  } else {
    form.addEventListener("submit", async (event) => {
      event.preventDefault();

      // Ensure terms are agreed to
      if (!isChecked) {
        alert("Please agree to the Terms of Service to proceed.");
        return;
      }

      // Hide previous messages
      successMessage?.classList.add("hidden");
      errorMessage?.classList.add("hidden");

      // Honeypot check
      const formData = new FormData(form);
      if (formData.get("website")?.trim()) {
        console.log("Bot detected");
        return;
      }

      // Remove website field from data payload to prevent clutter
      formData.delete("website");

      // Cooldown check
      const lastSubmit = parseInt(
        localStorage.getItem("lastEnrollSubmit") || "0",
        10
      );
      const now = Date.now();
      if (now - lastSubmit < SUBMIT_COOLDOWN) {
        alert("Please wait a few seconds before submitting again.");
        return;
      }
      localStorage.setItem("lastEnrollSubmit", now.toString());

      // Show loading state
      submitButton.disabled = true;
      submitButton.classList.add("opacity-50", "cursor-not-allowed");
      buttonText.textContent = "Submitting...";
      buttonSpinner.classList.remove("hidden");

      // Logic to split Full Name for Portal API
      const fullName = formData.get("name")?.toString() || "";
      const nameParts = fullName.split(" ");
      const firstName = nameParts[0] || "";
      const lastName = nameParts.slice(1).join(" ") || "";

      // Append standard fields expected by CRM if needed, or rely on form-urlencoded keys
      // Adding timestamp and source type for Webhook context
      formData.append("timestamp", new Date().toISOString());
      formData.append("type", "enrollment");

      try {
        const [ghlRes, portalRes] = await Promise.all([
          // 1. GHL Webhook (x-www-form-urlencoded)
          fetch(ENROLLMENT_FORM_WEBHOOK_URL, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams(formData).toString(),
          }),
          // 2. Portal API (Lead Creation - JSON)
          fetch("https://portal.rightruddermarketing.com/api/leads", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Accept: "application/json",
              "x-api-key": PORTAL_API_KEY,
            },
            body: JSON.stringify({
              first_name: firstName,
              last_name: lastName,
              email: formData.get("email")?.toString() || "",
              phone: formData.get("phone")?.toString() || "",
              campaign: "enrollment", // Using 'enrollment' campaign for this form
              account_random_id: CP_ACCOUNT_RANDOM_ID,
              // Optional: You can pass notes if supported
              // notes: formData.get("message")?.toString()
            }),
          }),
        ]);

        if (ghlRes.ok && portalRes.ok) {
          // Redirect to confirmation page
          window.location.href = "/enroll-confirmation";
        } else {
          throw new Error("One or both requests failed");
        }
      } catch (err) {
        console.error("Submission error:", err);
        errorMessage?.classList.remove("hidden");
        if (errorText) {
          errorText.textContent =
            "Something went wrong. Please try again or call us directly.";
        }
        errorMessage?.scrollIntoView({ behavior: "smooth", block: "nearest" });
      } finally {
        // Reset button state (If success, it stays disabled due to reset toggle logic, if error, we re-enable)
        if (isChecked) {
          submitButton.disabled = false;
          submitButton.classList.remove("opacity-50", "cursor-not-allowed");
        }

        buttonText.textContent = "Submit Enrollment Application";
        buttonSpinner.classList.add("hidden");
      }
    });
  }
</script>
