---
import { formatDate } from "./utils";
import type { CollectionEntry } from "astro:content";
import ImageComp from "../ImageComp.astro";
import { FaArrowRight, FaCalendarAlt } from "react-icons/fa";
import { COMPANY_NAME } from "../../data/consts";

interface Props {
  blogEntry: CollectionEntry<"blog">;
  smallCard?: boolean;
  index?: number;
}

const { blogEntry, smallCard = false, index = 0 } = Astro.props;

// Layout logic
const containerClasses = smallCard
  ? "flex flex-col sm:flex-row h-full lg:min-h-[220px] "
  : "flex flex-col h-full";

const imageContainerClasses = smallCard
  ? "w-full sm:w-2/5 h-48 sm:h-auto relative overflow-hidden shrink-0"
  : "w-full h-64 md:h-80 relative overflow-hidden shrink-0";

const contentClasses = smallCard
  ? "flex-1 p-6 flex flex-col justify-center"
  : "p-8 flex flex-col flex-1 ";
---

<a
  href={`/posts/${blogEntry.slug}`}
  class="group relative block bg-white overflow-hidden border border-sky-500 rounded-3xl transition-all duration-500 hover:-translate-y-2 hover:shadow-[0_20px_50px_rgba(0,0,0,0.5)] opacity-0 translate-y-8 blog-card"
  style={`transition-delay: ${index * 100}ms;`}
  data-astro-prefetch
>
  <div
    class="absolute inset-0 bg-linear-to-br from-sky-500/10 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"
  >
  </div>

  <article class={containerClasses}>
    {/* Image Section */}
    <div class={imageContainerClasses}>
      <ImageComp
        class="absolute inset-0 size-full object-cover transition-transform duration-1000 ease-out group-hover:scale-110"
        src={blogEntry.data.image}
        alt={blogEntry.data.title}
      />
      <div
        class="absolute inset-0 bg-linear-to-t from-slate-950 via-slate-950/20 to-transparent opacity-80 group-hover:opacity-60 transition-opacity duration-500"
      >
      </div>

      {/* Category Tag (Optional - if your schema has it) */}
      <div class="absolute top-4 left-4">
        <span
          class="px-3 py-1 bg-sky-800/90 backdrop-blur-sm text-white flex text-sm font-bold uppercase tracking-wide rounded-md shadow-lg"
        >
          {blogEntry.data.tags[0]}
        </span>
      </div>
    </div>

    {/* Content Section */}
    <div class={contentClasses}>
      {/* Meta Data */}
      <div
        class="flex items-center gap-3 text-[10px] font-bold uppercase tracking-[0.2em] text-sky-400 mb-4"
      >
        <span
          class="flex items-center gap-1.5 bg-sky-800/90 text-white px-4 py-2 rounded text-xs"
        >
          <FaCalendarAlt />
          {formatDate(blogEntry.data.pubDate)}
        </span>
        <span class="w-1 h-1 bg-slate-700 rounded-full"></span>
        <span class="text-slate-500 text-xs truncate max-w-[120px]">
          By {blogEntry.data.author || COMPANY_NAME}
        </span>
      </div>

      <h3
        class={`font-bold text-sky-900 transition-colors duration-300 group-hover:text-sky-600 leading-tight mb-4 ${
          smallCard
            ? "text-xl line-clamp-2"
            : "text-2xl md:text-3xl lg:text-4xl"
        }`}
      >
        {blogEntry.data.title}
      </h3>

      <p
        class={`text-sky-900 text-lg leading-relaxed mb-6 font-sans ${smallCard ? "line-clamp-2" : "line-clamp-3"}`}
      >
        {blogEntry.data.description}
      </p>

      <div
        class="mt-auto flex items-center justify-between border-t border-sky-600/45 pt-4"
      >
        <span
          class="text-lg font-bold uppercase tracking-[0.2em] text-sky-900 group-hover:text-sky-600 transition-colors flex items-center gap-2"
        >
          Read More
          <div
            class="text-sky-900 px-4 group-hover:text-sky-600 group-hover:translate-x-2 transition-transform duration-500 group-hover:bounce-horizontal"
          >
            <FaArrowRight />
          </div>
        </span>

        {/* Decorative corner accent */}
        <div
          class="w-1.5 h-1.5 lg:w-2 lg:h-2 rounded-full bg-sky-950 group-hover:bg-sky-500 transition-colors"
        >
        </div>
      </div>
    </div>
  </article>
</a>

<script>
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          (entry.target as HTMLElement).classList.remove(
            "opacity-0",
            "translate-y-8",
          );
          observer.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.1 },
  );

  document.querySelectorAll(".blog-card").forEach((card) => {
    observer.observe(card);
  });
</script>
